
#include <sh21.h>

void print_numero_and_time(char *line, int j, int flag_time)
{
  int       strtime;
  int       i;
  // time_t  timecaster;
  //
  // timecaster = (time_t)ft_atoi(line);
  // printf("time = %ld\n", timecaster);
  // if (timecaster != 0)
  // {
  //   strtime = ctime(&timecaster);
  //   ft_putstr(strtime);
  //   ft_putchar(' ');
  // }
  // *i += (int)ft_strlen(strtime);
  ft_putnbr(j);
  if (flag_time == 1)
  {
    ft_putchar(' ');
    strtime = ft_atoi(line);
    i = 0;
    if (strtime != 0)
      ft_putnbr(strtime);
    else
      ft_putstr("[NO TIMESTAMP]");
  }
  ft_putchar(' ');
}

void print_command_running(t_data *data, int j, int flag_time)
{
  time_t rawtime;
  int    res_time;

  ft_putnbr(j);
  if (flag_time == 1)
  {
    ft_putchar(' ');
    res_time = (int)time(&rawtime);
    if (res_time != 0)
      ft_putnbr(res_time);
    else
      ft_putstr("[NO TIMESTAMP]");
  }
  ft_putchar(' ');
  ft_putstr(data->cmd);
  ft_putchar('\n');
}

int  get_history_flag_time(t_data *data)
{
  char  *str;
  int   nb;

  str = find_arg(data->env, "HISTTIMEFORMAT");
  if (str[0] == '1' && str[1] == '\0')
    nb = 1;
  else
    nb = 0;
  free(str);
  return (nb);
}

int history_flag_none(t_data *data)
{
  char		*line;
  int     flag_time;
  size_t  i;
  size_t  j;

  if (get_history_fd(data) == 1 && data->history_fd == -1)
    return (0);
  j = 1;
  line = NULL;
  flag_time = get_history_flag_time(data);
  while (get_next_line(data->history_fd, &line) == 1)
  {
    i = 0;
    print_numero_and_time(line, j, flag_time);
    while (line[i] != ';' && line[i])
      i++;
    if (line[i])
      i++;
    ft_putstr(line + i);
    ft_putchar('\n');
    j++;
    free(line);
  }
  print_command_running(data, j, flag_time); // Pour afficher la commande history elle meme, flemme de changer le code dans le main
  if (close(data->history_fd) == -1)
  {
		// ft_putstr_fd("42sh: history: Failed to open/close history file\n", 2);
    // print_prompt(data->env, data);
    return (1);
  }
  data = NULL;
  return (0);
}
